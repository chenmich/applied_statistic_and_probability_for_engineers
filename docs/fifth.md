# 5、联合概率分布

在第3章和第四章研究的概率分布都是指间一随机变量的分布。但是有时为了描述一个事物，可能需要两个以上的随机变量，比如空气质量的问题。要描述空气质量，必须要描述它的颗粒物质(比如PM10)和臭氧的含量。这两个指标会同时受到几个因素的不同影响，因此，它们的分布是比此相关的，比如如果测得PM10上升，则臭氧浓度也可能上升，因此需要研究它们的共同概率。另外一个例子就是混凝土的立方抗压强度与耐久性两大类性能的相互影响。中国高速铁路混凝土的耐久性要求有多个指标，比如反映氯离子渗透的混凝土电通量指标。混凝土的抗压强度和电通量的测量值同样是随机变量。高速铁路混凝土往往对电通量的上限有一定的限制。但是，水胶比、减水剂用量、矿物外掺数的用量、砂率等等因素都对混凝土的也结构有重大影响，水胶比还直接影响混凝土立方抗压强度，并且是主要影响因素。当水胶比降低时，混凝土的立方抗压强度会提高，同时混凝土的电通量会降低。种种因素都要求我们去研究在共同因素的作用下，两个随机变量的概率分布的性质。这是本章要解决的问题。

## 5.1、两个或多个随机变量

在[第3章](third.md)和[第四章](fourth.md)我们研究了单一随机变量的概率分布。但是在随机实验中往往需要定义多个随机变量。比如空气质量的研究中，往往至少需要定义它的PM10和臭氧浓度。我们生产的混凝土原材料也需要两个以上的指标，比如水泥。我们关心水泥的早期强度，也关心它的需水量(用标准稠度用水量量化）。水泥的需要量指标标准稠度用水量都与水泥的早期强度都受水泥细度的影响。因此，当我们测量早期强度增高时，有可能它的标准稠度用水量也会增高。

这样的实例有很多。在高速铁中大建设时期，要求它的混凝土是高性能混凝土，混凝土结构使用寿命需要100年。为此要限定混凝土的某些耐久性指标，比如反映氯离子渗透性能的电通量。如果我们用随机变量$X$表示混凝土的立方抗压强度，用$Y$表示它的电通量指标。由于减水剂用量、矿物外掺料的品种及用量都会改变混凝土内部毛细孔的孔径分布，因此为改变电通量的大小。特别是矿物外掺的作用可以持续相当相当长的一个日期(比如50年)，它即会不断地改进毛细孔的结构，也会改进混凝土的立方抗压强度，这种因素会同时影响两个随机变量。同样的，水胶比也能影响早期的混凝土强度，影响毛细孔的总体积率，这也会对抗压强度和电通量产生影响。这些影响究竟如何呢？需要我们去研究$X$和$Y$的概率。比如，如果$X$的范围在$[30, 70]$MPa，$Y$的范围在$[300, 2800]$库伦。我们可会关心$P(30<X<70\text{和}300<Y<2800)$。

因为我们对一批生产的混凝土同时取样制作立方抗压强度试件和电通量用试件，因此材料和配合比是相同的，材料和生产过程的波动会同时影响这两种试件的抗压强度和电通量测量值。所以，我们希望抗压强度要高，同时还希望电通量要小。

一般地，如果$X$和$Y$是两个随机变量，定义它们的共同行为的概率分布就称为**联合概率分布**。这是本章要研究的主要内容。
### 5.1.1、联合概率分布

为了简化，我们从两个随机变量的随机实验开始研究联合分布，然后再推广到多于两个随机变量的联合概率分布。

如果$X$和$Y$是离散随机变量，那么它们的联合概率分布可以用在范围$(X, Y)$内所有的点$(x,y)$及所对应的概率来描述。有时我们又称两个随机变量的联合概率分布为**双变量概率分布**或**双变量分布**。也可以使用联合分布质量函数来描述两个离散随机变量的联合分布。同时为了简化，我们把概率$P(X=x\text{和}Y=y)$简写为$P(X=x,Y=y)$。

!!!note "联合概率质量函数"
    随机变量$X$和$Y$的**联合概率质量函数**$f_{xy}(x,y)$需要满足：

    $$
    \begin{align}
    (1)&\qquad f_{xy}(xy)\leq 0\nonumber\\
    (2)&\qquad \sum_{x}\sum_{y}f_{xy}(x,y)=1\nonumber\\
    (3)&\qquad f_{xy}(x,y)=P(X=x,Y=y)\qquad
    \end{align}
    $$

对于单一随机变量的质量分布我们假定在它的取值范围之外的概率都为零，对于多元随机变量也一样，在所有随机变量的取值范围之外的概率也为零。这是概率质量函数的特点。

两个以上的连续随机变量组成一个二维的连续空间。在这个空间上它的**联合概率分布密度函数**，通过密度函数即可以求得任意区域$R$上的概率。联合概率密度函数在任意区域$R$上的二元积分即是这两个连续随机变量在$R$上的概率。这个概率还可以解释为概率分布密度曲面在$R$上围成的体积。

!!!note "联合概率密度函数"
    用$f_{XY}(x,y)$表示连续随机变量$X$和$Y$的**联合概率密度函数**，它应该满足：

    $$
    \begin{align}
    (1)&\qquad \text{对于所有x,y}\qquad f_{XY}(x,y)\geq 0 \nonumber\\
    (2)&\qquad \int\limits_{-\infty}^{\infty}\int\limits_{-\infty}^{\infty}f_{XY}(x,y)dxdy=1\nonumber\\
    (3)&\qquad\text{对于二维空间上的任意区域R：}\nonumber\\
    &\qquad\qquad P((X,Y)\in R)=\int\limits_{R}\int f_{XY}(x,y)dxdy\qquad\qquad\qquad
    \end{align}
    $$

### 5.1.2、边缘概率分布

在随机实验中如果定义了两个及两个以上的随机变量，一个非常重要的问题就是区分$X$和$Y$的联合分布和各个变量的单独分布。随机变量的单独概率分布指的是它的**边缘概率分布**。

一般地，随机变量$X$的边缘概率分布可以由$X$与其它变量的联合概率分布求得。比如，设想随机变量$X$和$Y$，为了确定$P(X=x)$的概率，只需要固定$X=x$加总所有的$P(X=x,Y=y)$的概率。即：

$$
P(X=x)=\sum\limits_{y}P(X=x,Y=y)
$$

!!!note "实例5.1"
    下表为连续随机变量$X$和$Y$的联合概率质量函数。试求$P(X=3)$的值。
    ![table5.1](images/table5.1.png)
    
    $$
    \begin{align}
    P(x=3)=f_{X}(3)&=P(X=3,Y=1)+P(X=3,Y=2)\nonumber\\
    &\qquad+P(X=3,Y=3)+P(X=3,Y=4)\nonumber\\
    &=0.25+0.2+0.05+0.05=0.55\nonumber
    \end{align}
    $$

从实例5.1中的概率质量函数表，可以分别加上$X$取某一值的列的所有概率质量函数值求得$X$取该值的概率，并写在表格的边缘。同样地，分别加上$Y$取某一值的行的所有概率质量函数值可以求得$Y$取该值的概率，也写在表格的边缘。正是因为这些概率写在表格的连续，所以早期就被称为为边缘概率。

对于连续随机变量，仍然是求和的概念，只是要用积分求和，所以有：

!!!note "边缘概率密度函数"
    连续随机变量$X$和$Y$的联合概率密度函数为$f_{XY}(x,y)$，则$X$和$Y$的**边缘概率密度函数**分别为：

    $$
    \begin{equation}
    f_{X}(x)=\int\limits_{y} f_{XY}(x,y)dy\qquad\text{和}\qquad f_{Y}=\int\limits_{x}f_{XY}(x,y)dx\qquad
    \end{equation}
    $$

    其中，第一个积分是针对$X=x$时所有$(X,Y)$的积分，第二个积分是针对$Y=y$时对所有$(X,Y)$的积分。

### 5.1.3、条件概率分布

两个随机变量的联合概率分布在本质上指的是在它们的取值空间中同时满足某一个条件的概率，其概率的完整地书写为$P(X=x and Y=y)$，在逻辑上两者是“与”的关系。而条件概率又有不同，它是指在某一个条件成立的前提下，随机变量取某一个值时的概率。考虑两个随机变量，则它应该是$P(X=x|Y=y)$。

还记得事件$A$和$B$的条件概率$P(B|A)=P(A\cap B)/P(A)$。将它应用到两个随机变量上，只需要将$X=x$和$Y=y$定义为对应事件$A$和$B$即可。

!!!note "实例5.2"
    仍然以实例5.1的数据为例。我们要求$P(Y=1|X=3)$的概率。我们定义事件$X=3$为事件$A$，$Y=1$为事件$B$。则有：

    $$
    \begin{align}
    P(Y=1|X=3)&=P(X=3,Y=1)/P(X=3)\nonumber\\
    &=f_{XY}(3,1)/f_{X}(3)=0.25/0.55=0.454\nonumber
    \end{align}
    $$

    同理可以得到：

    $$
    \begin{align}
    P(Y=2|X=3)&=P(X=3,Y=2)/P(X=3)\nonumber\\
    &=f_{XY}(3,2)/f_{X}(3)=0.2/0.55=0.364\nonumber
    \end{align}
    $$

    还可以求得$P(Y=3|X=3)=0.091$以及$P(Y=4|X=3)=0.091$。还需要注意，$P(Y=1|X=3)+P(Y=2|X=3)+P(Y=3|X=3)P(Y=4|X=3)=1$。这四个概率定义了在给定$X=3$时的$Y$的概率分布。

因此，我们可以认为在给定$X=x$的前提下定义的$Y$的条件概率是一个新的概率分布。

!!!note "条件概率密度函数"
    设连续随机变量$X$和$Y$，它的联合概率密度函数为$f_{XY}(x,y)$，则在给定$X=x$的前提下$Y$的**条件概率密度函数**为：

    $$
    \begin{equation}
    \text{对于}f_{X}(x)>0\qquad f_{Y|x}(y)=\frac{f_{XY}(x,y)}{f_{X}(x)}\qquad\qquad
    \end{equation}
    $$

条件概率密度函数提供了在给定$X=x$条件下$Y$的条件概率。

!!!note ""
    因为条件概率密度函数$f_{Y|x}(y)$是在$R_x$上所有$y$的概率密度函数，所以它满足以下关系：

    $$
    \begin{align}
    (1)&\qquad f_{Y|x}(y)\geq 0\nonumber\\
    (2)&\qquad \int f_{Y|x}(y)dy=1\nonumber\\
    (3)&\qquad \text{对于在Y的定义域内的任意集合B}\qquad P(Y\in B|X=x)=\int\limits_{B}f_{Y|x}(y)dy\qquad
    \end{align}
    $$

我们要记住的就是，两个随机变量定义的条件概率是一种条件分布，因此它同样有平均值和方差。其定义如下：

!!!note "条件平均值和方差"
    在给定$X=x$条件下的**条件平均值**为$E(Y|x)$或$\mu_{Y|x}$，我们有：

    $$
    \begin{equation}
    E(Y|x)=\int\limits_{Y}yf_{Y|x}(y)dy\qquad
    \end{equation}
    $$

    在给定$X=x$的条件下$Y$的条件方差为$V(Y|x)$或$\sigma^2_{Y|x}$，我们有：

    $$
    V(Y|x)=\int\limits_{y}(y-\mu_{Y|x})^2f_{Y|x}(y)dy=\int\limits_{y}y^2f_{Y|x}(y)dy-{\mu^2_{Y|x}}\qquad
    $$

### 5.1.4、独立性

在某些随机实验中，随机变量$X$的值并不会影响与之相关的随机变量$Y$的取值概率。比如，在我们制作的混凝土立方抗压强度试件中，一个试件的边长与该试件所测定的强度值可以定义为两个变量，即随机变量$X$表示试件的边长，随机变量$Y$表示其测得的强度。如果我们规定边长随机变量$X$有两个值，一个是合格，一个是不合格，分别用0和1表示；同时又规定强度随机变量$Y$也有两个值，一个是合格，一个是不合格，分别用0和1表示。即：

$$
X=\begin{cases}1&\qquad\text{如果长度满足要求}\\0&\qquad\text{不满足要求}\end{cases}
$$

$$
Y=\begin{cases}1&\qquad\text{如果强度满足要求}\\0&\qquad\text{不满足要求}\end{cases}
$$

假定随机变量$X$和$Y$的联合概率分布为$f_{XY}(x,y)$，如图5.1(a)所示，其边缘概率分布可见图5.1(a)。请注意$f_{XY}(x,y)$=f_{X}(x)f_{Y}(y)$成立。它们的条件概率质量函数$f_{Y|x}(y)$可见图5.1(b)。同样请注意，对于任意$x$$f_{Y|x}(y)=f_{Y}(y)$也成立。这表明，无论混凝土试件的边长是否满足要求，都不会影响混凝土强度是否满足要求。

!!!note "图5.1、随机变量$X$和$Y$的联合分布与条件概率分布"
    ![fig5.1](images/fig5.1.png)

同样地，如果把随机变量取某一个值视为一个随机事件，那么可以利用独立事件概率的关系，即无论何时，只要对于所有$(x,y)$，$f_{XY}(x,y)=f_{X}(x)f_{Y}(y)$成立，那么随机事件$X$和$Y$就是**独立**的随机变量。同时，也要注意到，只要两个随机变量是独立的，则对于所有$(x,y)$，$f_{XY}(x,y)=f_{X}(x)f_{Y}(y)$也成立。这个条件是充分必要条件。只要有一个$(x,y)$的组合导致$f_{XY}(x,y)=f_{X}(x)f_{Y}(y)$不成立，那么两个随机变量也不是独立的。如果两个随机变量$X$和$Y$是独立的，那么对于$f_{X}(x)>0$，我们可以得到：

$$
f_{Y|x}(y)=\frac{f_{XY}(x,y)}{f_{X}(x)}=\frac{f_{X}(x)f_{Y}(y)}{f_{X}(x)}=f_{Y}(y)
$$

由此我们可以得到两个随机变量独立的定义：

!!!note "随机变量的独立性"
    对于随机变量$X$和$Y$，只要下述条件任意一个为真，则其它条件也会为真，此时$X$和$Y$是**独立的**：

    $$
    \begin{align}
    &(1)\qquad f_{XY}(x,y)=f_{X}(x)f(y)_{Y}\nonumber\\
    &(2)\qquad f_{Y|x}(y)=f_{Y}(y)\qquad \forall x,y\space\space\text{with}\space\space f_{X}(x)>0\nonumber\\
    &(3)\qquad f_{X|y}(x)=f_{X}(x)\qquad \forall x,y\space\space\text{with}\space\space f_{Y}(y)>0\nonumber\\
    &(4)\qquad \text{对于}X\text{和}Y\text{的取值范围内的任意集合}A\text{和}B\text{存在}\qquad P(X\in A, Y\in B)=P(X\in A)P(Y\in B)\qquad
    \end{align}
    $$

如果已开发出了我们的研究系统的概率模型，那么可以从随机变量分布的性质就可以确定是否彼此独立。如果我们对所研究系统有充分的研究和认识，也可以假定随机变量是独立的。在假定独立的基础上，从边缘概率分布可以计算出两个随机变量的概率。比如在某一计算机控制系统中，计算机制搜索时间与成人的高度这两个随机变量就是彼此独立的。

### 5.1.5、多于两个随机变量

在一个随机实验过程中，可以定义两个随机变量，当然也能定义多个随机变量。多个随机变量也会有联合概率分布。

假定有随机变量$X_1,X_2,X_3,\cdots,X_p$，只要有计算在$p$维空间中的某一区域$R$的$X_1,X_2,X_3,\cdots,X_p$概率的方法，则可以确定$X_1,X_2,X_3,\cdots,X_p$的概率分布。设$f_{X_1,X_2,X_3,\cdots,X_p}(x_1,x_2,x_3,\cdots,x_P)$为$X_1,X_2,X_3,\cdots,X_p$的联合概率密度函数，则可以用在区域$R$上对$f_{X_1,X_2,X_3,\cdots,X_p}(x_1,x_2,x_3,\cdots,x_P)$的多重积分计算$X_1,X_2,X_3,\cdots,X_p$在区域$R$上的概率。

!!!note "联合概率密度函数"
    对于连续随机变量$X_1,X_2,X_3,\cdots,X_p$，我们用$f_{X_1,X_2,X_3,\cdots,X_p}$表示它的**联合概率密度函数**，则此函数应该满足以下条件：

    $$
    \begin{align}
    &(1)\qquad f_{X_1,X_2,X_3,\cdots,X_p}(x_1,x_2,\cdots,x_p)\geq 0\nonumber\\
    &(2)\qquad \int\limits_{-\infty}^{\infty}\int\limits_{-\infty}^{\infty}\cdots\int\limits_{-\infty}^{\infty}f_{X_1X_2\cdots X_p}(x_1, x_2,\cdots x_p)dx_1dx_2\cdots dx_p=1\nonumber\\
    &(3)\qquad\text{对于p维空间的任意区域R，}\nonumber\\
    &P[(X_1,X_2,\cdots,X_p)\in B]=\int\int\limits_{B}\int f_{X_1,X_2,\cdots,X_P}(x_1,x_2,\cdots,x_p)dx_1dx_2\cdots dx_p\qquad
    \end{align}
    $$

多个随机变量的边缘分布也是我们要关心的概率分布，它的定义可以从两个随机变量的边缘分布推广而得，对于连续性随机变量组，如果知道它们的联合概率密度函数，那么可以计算连续随机变量组的边缘分布：

!!!note "边缘概率密度函数"
    如果连续随机变量$X_1,X_2,\cdots,X_p$的概率密度函数为$f_{X_1X_2X_p}(x_1,x_2,\cdots,x_p)$，则$X$的**边缘概率密度函数**为：

    $$
    \begin{equation}
    f_{X_i}(x_i)=\int\int\cdots\int f_{X_1X_2\cdots X_p}(x_1,x_2,\cdots,x_p)dx_1dx_2\cdots dx_{i-1}dx_{i+1}\cdots dx_p \qquad
    \end{equation}
    $$

    其中积分区间是在$X_i=x_i$条件下所有$X_1,X_2,\cdots,X_p$的所有点组成的区域。

同样，我们可以有多个连续随机变量联合概率分布的平均值和方差的计算方法：

!!!note "联合分布的平均值和方差"
    
    $$
    \begin{align}
    &\qquad E(X_i)=\int\limits_{-\infty}^{\infty}\int\limits_{-\infty}^{\infty}\cdots\int\limits_{-\infty}^{\infty}x_if_{X_1X_2\cdots X_p}(x_1,x_2,\cdots,x_p)dx_1dx_2\cdots dx_p\nonumber\\
    &\text{和}\\
    &\qquad V(X_i)=\int\limits_{-\infty}^{\infty}\int\limits_{-\infty}^{\infty}\cdots\int\limits_{-\infty}^{\infty}(x_i-\mu _{X_i})^2f_{X_1X_2\cdots X_p}(x_1,x_2,\cdots,x_p)dx_1dx_2\cdots dx_p\nonumber
    \end{align}
    $$

一组随机变量之间也有独立性存在，其定义为：

!!!note "独立性"
    设有一组随机变量$X_1, X_2, \cdots,X_p$，对于所有的$x_1,x_2,\cdots,x_p$，当且仅当下式存立：

    $$
    \begin{equation}
    f_{X_1X_2\cdots X_p}(x_1, x_2, \cdots, x_p)=f_{X_1}(x_1)f_{X_2}(X_2)\cdots f_{X_p}(x_p)
    \end{equation}
    $$

    则这组随机变量之间是相互独立的。

有必要注意的是，公式(11)是一组随机变量之间相互独立的充分必要条件。

针对相互独立的一组随机变量$X_1, x_2,\cdots,X_p$和任意的区域$A_1, A_2, \cdots, A_p$可以推导得到:

$$
P(X_1\in A_1, X_2\in A_2,\cdots, X_p\in A_p)=P(X_1\in A_1)P(X_2\in A_2)\cdots P(X_p\in A_p)
$$

## 5.2、协方差和相关性